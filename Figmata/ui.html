<html>


<body>
  <div id="monaco-editor" style="height:1000px"></div>
</body>
</html>


<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min/vs/loader.js"></script>
    <script>
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min/vs' }});
        var editor
        require(['vs/editor/editor.main'], function() {
            editor = monaco.editor.create(document.getElementById('monaco-editor'), {
                value: [
                    'function x() {',
                    '\tconsole.log("Hello world!");',
                    '}'
                ].join('\n'),
                language: 'javascript'
            });
            /*
            if (localStorage.savedtext == undefined){
                localStorage.savedtext = editor.getValue();
            }
            else{
                editor.setValue(localStorage.savedtext);
            }*/
            editor.getModel().onDidChangeContent(function() {
              //window.postMessage(editor.getValue())
              parent.postMessage({ pluginMessage: { code: editor.getValue()} }, '*')
                //eval(editor.getValue());
                //localStorage.savedtext = editor.getValue();
            });
        });
        window.onmessage = (event) => {
          console.log(event.data.pluginMessage)
          if (event.data.pluginMessage?.test !== undefined){
            editor.setValue(event.data.pluginMessage.test)
          }
        }

        </script>